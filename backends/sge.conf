include required(classpath("application"))

akka {
  coordinated-shutdown.phases {
    abort-all-workflows {
      timeout = 300 seconds      
    }
    stop-io-activity{
      timeout = 30 seconds
    }
  }
}

system {
  abort-jobs-on-terminate = true
  graceful-server-shutdown = true
}

backend {
    default = "sge"
    providers {
        sge {
            actor-factory = "cromwell.backend.impl.sfs.config.ConfigBackendLifecycleActorFactory"
            config {
                #concurrent-job-limit = 500
                runtime-attributes = """
                String sge_pe = "shm"
                Int cpu = 1
                Int? time
                Int? memory_mb
                String? sge_queue
                """
                submit = """
                qsub \
                -terse \
                -V \
                -b n \
                -N ${job_name} \
                -wd ${cwd} \
                -o ${out} \
                -e ${err} \
                ${if cpu>1 then "-pe " + sge_pe + " " + cpu else " "} \
                ${"-l h_vmem=" + memory_mb/cpu + "m"} \
                ${"-l s_vmem=" + memory_mb/cpu + "m"} \
                ${"-l h_rt=" + time*3600} \
                ${"-l s_rt=" + time*3600} \
                ${"-q " + sge_queue} \
                ${script}
                """
                kill = "qdel ${job_id}"
                check-alive = "qstat -j ${job_id}"
                job-id-regex = "(\\d+)"
            }
        }
    }
}
